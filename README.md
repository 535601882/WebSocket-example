
# 我的直播小项目：一个 WebRTC + WebSocket 的实验

这个项目算是我自己探索实时通信技术的一个记录。一开始我的目标很简单：就是想用 Node.js 和原生的 WebSocket 从零搭一个聊天室，不想用 Socket.IO 这种把底层细节都藏起来的库。

把聊天室做完后，我就开始琢磨：要是给它加上视频直播，会麻烦吗？这个问题直接把我带进了 WebRTC 的“坑”里。这个项目就是我这次实验的结果：一个能跑起来的、简单的直播应用，主要就是搞明白了怎么让 WebRTC 和 WebSocket 这两个东西一起合作。

## 它能做啥

这个 App 是一个直播平台的简单原型，主要有两个角色：

*   **主播：** 你可以“创建直播间”，这会打开你的摄像头和麦克风。
*   **观众：** 你能看到当前有谁在直播，可以加入任何一个直播间观看。

在观看直播的同时，屏幕上会有一个聊天浮层，就像你在抖音或B站看直播时那样。我花了一点时间调整 UI，确保在任何视频背景下，弹幕都能看清楚。

## 主要功能 & 我学到了啥

*   **WebRTC 视频直播：** 这部分是核心挑战。这个 App 使用 WebRTC 来实现主播到观众的音视频流传输。服务器本身不处理视频数据，它只负责“牵线搭桥”。

*   **原生 WebSocket 用于信令和聊天：** 我坚持使用了 Node.js 的 `ws` 库。所有的聊天消息，以及更重要的 WebRTC 信令（建立连接所必需的 offer、answer、ICE candidate），都通过这条 WebSocket 连接来传输。

*   **手动实现心跳：** 为了让 WebSocket 连接更稳定，我自己在服务器端写了 `ping/pong` 心跳，用来发现并断开那些“假死”的连接。

*   **简单的 Vue 前端：** 前端是用 Vue 3 写的，但我是直接用 CDN 链接引入的。这样做是为了避免配置 `npm run build` 之类复杂的前端工程化流程，让我能把注意力集中在网络通信这块儿。

*   **聊天浮层 UI：** 我觉得聊天信息直接显示在视频上会很酷。我用了一些 CSS 的小技巧，比如 `position: absolute` 和 `linear-gradient` 背景，让聊天区能浮在视频上，同时又不影响观看。

## 怎么跑起来

### 环境准备

你需要先安装 Node.js 和 npm。

### 安装步骤

1.  把项目克隆到本地：
    ```bash
    git clone https://github.com/535601882/WebSocket-example.git 
    cd your-repo
    ```

2.  安装依赖：
    ```bash
    npm install
    ```

### 启动

1.  **启动服务器：**
    ```bash
    node server.js
    ```
    看到提示“服务器已启动，正在监听 http://localhost:3000”，就说明成功了。

2.  **打开 App：**
    在浏览器里打开 `http://localhost:3000`。

3.  **试试看：**
    *   打开一个浏览器标签页，选择“我是主播”。
    *   点击按钮开始直播。**这时浏览器会请求摄像头和麦克风权限，一定要点“允许”。**
    *   再打开一个（或多个）标签页，选择“我是观众”。
    *   你应该能看到主播的房间，点击加入，稍等片刻就能看到视频了。

## 一些限制和未来的想法

这毕竟只是个学习项目，离真正的线上产品还有距离。下面这些是我想到的问题和未来可以做的事：

*   **需要 TURN 服务器：** WebRTC 在本地网络里跑得很顺畅，但要是在复杂的公网环境（比如用户在不同的路由器后面），就需要一个 TURN 服务器来帮忙转发视频流量。这个项目里我还没配置。
*   **没有正经的用户系统：** 现在的用户名都是随机生成的，下一步可以加上真正的登录注册功能。
*   **聊天记录不保存：** 聊天消息是临时的，一刷新就没了。

---
