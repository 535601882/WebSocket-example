
# 极简直播聊天室

这是一个基于 Node.js 和原生 WebSocket 构建的实时直播聊天室原型。它的设计初衷是为了帮助开发者深入理解 WebSocket 的工作原理，而非依赖 Socket.IO 等封装库。麻雀虽小，五脏俱全，它模拟了直播间中常见的聊天互动场景。

## 项目简介

你是否好奇直播间的弹幕和聊天是如何实时同步的？这个项目就是答案！它提供了一个基础的直播聊天室功能，分为“主播”和“观众”两种角色。主播可以创建房间，观众可以选择加入。一旦进入房间，大家就能实时聊天，还能看到谁在打字、谁加入了房间，甚至主播还能发布醒目的公告。

整个项目力求简洁，前端使用 Vue 3 CDN 引入，后端则直接使用 `ws` 库处理 WebSocket 连接，没有引入过多复杂的第三方依赖，非常适合作为学习 WebSocket 的入门实践。

## 功能一览

*   **角色选择：** 进入应用时，可选择扮演“主播”或““观众”。
*   **房间管理：**
    *   主播：创建专属直播间。
    *   观众：获取当前活跃房间列表，选择加入。
*   **实时聊天：**
    *   主播与观众双向文字交流。
    *   消息带有发送者身份（主播/观众）和用户名。
*   **直播间状态通知：**
    *   新用户进入/离开房间时，系统自动发送欢迎/离开消息。
    *   主播结束直播时，房间自动解散，所有观众收到通知。
*   **在线人数显示：** 实时更新当前房间的在线观众数量。
*   **在线用户列表：** 显示当前房间内所有在线用户的列表。
*   **主播公告：** 主播可以发布醒目的公告消息，在聊天流中高亮显示。
*   **正在输入提示：** 当其他用户正在输入消息时，显示“xxx 正在输入...”的提示。
*   **心跳机制：** 服务器端实现 Ping/Pong 心跳，自动检测并清理僵尸连接，提升连接稳定性。
*   **消息限流：** 服务器端对用户消息发送频率进行限制，防止恶意刷屏。
*   **消息时间戳：** 每条聊天消息都带有服务器生成的时间戳。
*   **XSS 防御：** 服务器端对用户输入内容进行 HTML 转义，有效防止跨站脚本攻击。

## 快速开始

### 准备工作

确保你的电脑上安装了 Node.js 和 npm。

### 安装依赖

首先，克隆这个项目到你的本地：

```bash
git clone https://github.com/your-username/socket-io-example.git # 如果你上传到GitHub，请替换为你的仓库地址
cd socket-io-example
```

然后，安装项目所需的 Node.js 依赖：

```bash
npm install
```

### 运行项目

1.  **启动后端服务器：**
    在项目根目录下运行：
    ```bash
    node server.js
    ```
    看到 `服务器已启动，正在监听 http://localhost:3000` 字样，说明服务器已成功启动。

2.  **访问前端界面：**
    在你的浏览器中打开 `http://localhost:3000`。

## 如何使用

1.  **选择身份：** 在打开的页面中，点击“我是主播”或“我是观众”。
2.  **主播操作：**
    *   点击“创建直播间”。
    *   成功后，你将进入聊天界面，可以发送消息或发布公告。
    *   尝试打开多个浏览器窗口，以“观众”身份加入你的直播间。
    *   点击“结束直播”可以解散房间。
3.  **观众操作：**
    *   选择“我是观众”后，页面会显示当前活跃的直播间列表。
    *   点击一个房间即可加入。
    *   在聊天框中输入文字，与主播和其他观众互动。
4.  **测试功能：**
    *   **心跳：** 尝试断开网络连接（或在浏览器开发者工具中模拟离线），观察服务器端是否能检测到掉线。
    *   **限流：** 快速连续发送多条消息，看看是否会触发限流提示。
    *   **XSS：** 尝试发送 `<script>alert('hack');</script>` 这样的内容，验证是否会被转义。

## 技术亮点

*   **纯原生 WebSocket：** 放弃了 Socket.IO，直接使用 Node.js 的 `ws` 库和浏览器原生的 `WebSocket` API，让你能更清晰地看到 WebSocket 协议的运作方式。
*   **Vue 3 CDN + Setup 语法：** 前端采用轻量级的 Vue 3，通过 CDN 引入，并使用最新的 `setup` 语法，代码结构清晰。
*   **HTTP 与 WebSocket 分工：** 演示了如何合理地将 HTTP (获取房间列表) 和 WebSocket (实时通信) 结合使用。
*   **核心功能实现：** 包含了心跳、限流、XSS 防御、断线重连等生产环境中常见的关键功能实现。

## 待优化和扩展

*   **消息持久化：** 当前消息不存储，刷新页面会丢失。可以集成数据库（如 SQLite, MongoDB）来保存聊天记录。
*   **用户认证：** 引入真正的用户登录和身份验证机制，而非随机生成用户名。
*   **房间标题/描述：** 允许主播为房间设置自定义标题。
*   **表情/图片：** 支持发送表情或图片消息。
*   **管理员功能：** 实现禁言、踢人等更细致的房间管理功能。
*   **前端 UI/UX 优化：** 进一步美化界面，提升用户体验。

---

希望这个项目能帮助你更好地理解 WebSocket 的魅力！
